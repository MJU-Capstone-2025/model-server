# 모델 서버 설계 문서

## 1. 시스템 구조

### 1.1 서버 구성

-   FastAPI 기반 비동기 API 서버
-   데이터 수집, 전처리, 학습, 예측 모듈
-   파일 기반(`.csv`) 데이터 저장소

## 2. 현재 서버 구조 (Beta)

![flow-chart](https://raw.githubusercontent.com/MJU-Capstone-2025/model-server/main/docs/beta-flowchart.drawio.svg)

### 2.1 기본 개념

현재 모델은 최신 데이터 수집이 불가능한 제약 조건 하에서 작동합니다:

-   특정 기간의 과거 데이터만 사용 가능
-   모델은 2023/12/31까지의 데이터로 학습하여 2024/01/01부터 8주간 가격 예측
-   이후 8주간 데이터를 추가 학습하고 다시 8주간 예측 결과 반환
-   이 과정을 반복하여 2024/12/31까지 총 52주의 예측 결과 생성

### 2.2 현재 메인 서버 흐름

1. `main.py` 실행 시:

    - 이미 예측 결과가 있는지 확인
    - 결과가 있으면 즉시 예측 데이터 반환
    - 결과가 없으면 모델 학습 프로세스 시작

2. 모델 학습 준비:
    - 뉴스 데이터 처리 경로와 기후/경제 데이터 처리 경로로 분기

### 2.3 현재 모델 학습 흐름

1. 뉴스 데이터 처리:

    - 핵심 기사 필터링
    - 모델 학습 및 결과 저장
    - 모델 통합 과정에 결과 전달

2. 기후/경제 데이터 처리:

    - 보유 중인 기후/경제 데이터로 모델 학습
    - 결과 저장 및 모델 통합 과정에 결과 전달

3. 모델 통합:
    - 뉴스 기반 모델과 기후/경제 기반 모델 통합
    - 최종 예측 결과 저장 및 API로 반환

## 3. 미래 확장 계획 (Real-time)

![future-flow-chart](https://raw.githubusercontent.com/MJU-Capstone-2025/model-server/main/docs/server-flowchart.drawio.svg)

### 3.1 확장 목표

향후 최신 데이터를 자동으로 수집할 수 있는 시스템으로 확장 계획:

-   실시간 가격 데이터 자동 수집
-   뉴스 데이터 자동 크롤링 및 전처리
-   기후/경제 데이터 자동 수집

### 3.2 확장된 메인 서버 흐름

1. `main.py` 실행 시 병렬 처리:

    - 데이터 수집 및 모델 학습 프로세스
    - API 엔드포인트 (/prediction)

2. 예측 결과 요청 처리:
    - 예측 결과 존재 시 → 즉시 반환
    - 결과 미존재 시 → 모델 학습 진행하면서 전날 예측 결과 즉시 반환

### 3.3 확장된 데이터 수집 프로세스

1. 뉴스 데이터:

    - 최신 데이터 존재 여부 자동 확인
    - 미존재 시 자동 수집
    - 수집 데이터 전처리 및 저장

2. 기후/거시경제 데이터:
    - 최신 데이터 존재 여부 자동 확인
    - 미존재 시 자동 수집
    - 수집 데이터 전처리 및 저장

### 3.4 확장된 모델 학습 흐름

1. 뉴스 데이터 처리:

    - 핵심 기사 필터링 알고리즘 고도화
    - 증분 학습(incremental learning) 지원

2. 기후/경제 데이터 처리:

    - 실시간 데이터 반영 모델링
    - 시간에 따른 가중치 적용

3. 모델 통합 및 반환:
    - 두 모델의 결과 통합 알고리즘 고도화
    - 최종 예측 결과 저장
    - API 응답 최적화

## 4. 기술적 구현 비교

| 기능        | 현재(Beta)                  | 확장 후(Real-time)        |
| ----------- | --------------------------- | ------------------------- |
| 데이터 수집 | 수동(특정 기간 데이터만)    | 자동(실시간 업데이트)     |
| 예측 방식   | 8주 단위 점진적 예측        | 매일 56일(8주) 예측       |
| 응답성      | 예측 결과 없을 시 대기 필요 | 즉시 응답(전날 결과 반환) |
| 모델 학습   | 배치 방식                   | 실시간 증분 학습          |
| 신뢰도 측정 | 2024년 전체 예측값 분석     | 실시간 예측 정확도 분석   |
